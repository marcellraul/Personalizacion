import {
  Component,
  OnInit,
  ViewChild,
  ElementRef,
  Input,
  Output,
  EventEmitter,
} from '@angular/core';

import { Shape } from '../../services/shape';
import { Subject } from 'rxjs';

@Component({
  selector: 'app-canvas',
  templateUrl: './canvas.component.html',
  styleUrls: ['./canvas.component.scss'],
})
export class CanvasComponent implements OnInit {
  type = 'rectangle';

  constructor() {}
  shapeType = 'rectangle';
  urlImage: string = 'assets/images/98_original.png';
  urlImage2: string =
    'data:image/jpeg;base64,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';

  @Output() onTypeChange = new EventEmitter<string>();
  @Input() shapesToDraw: Shape[];
  @Input() currentShape: Subject<Shape>;

  // the shape being just drawn
  createdShape: Shape;

  ngOnInit(): void {}

  setType(type: string) {
    this.shapeType = type;
    console.log(this.shapeType);
  }
  startDrawing(evt: MouseEvent) {
    this.createdShape = {
      type: this.shapeType,
      x: evt.offsetX,
      y: evt.offsetY,
      w: 0,
      h: 0,
    };

    this.shapesToDraw.push(this.createdShape);
    console.log('shapesdraw', this.shapesToDraw);
  }

  keepDrawing(evt: MouseEvent) {
    if (this.createdShape) {
      this.currentShape.next(this.createdShape);
      this.createdShape.w = evt.offsetX - this.createdShape.x;
      this.createdShape.h = evt.offsetY - this.createdShape.y;
    }
    // console.log(this.currentShape);
    // console.log(this.createdShape);
  }

  stopDrawing(evt: MouseEvent) {
    this.createdShape = null;
    console.log('stopdrawing');
  }
}
